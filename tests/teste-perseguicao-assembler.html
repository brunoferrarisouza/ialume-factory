<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lume - Jogo Educativo</title>
    <style>
        /* ===== PALETA LUME ===== */
:root {
    --lume-primary: #ffd700;
    --lume-glow: #fff8dc;
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --correct: #51cf66;
    --wrong: #ff6b6b;
}

/* ===== RESET ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--primary-gradient);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

/* ===== CONTAINER ===== */
.game-container {
    background: white;
    border-radius: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    max-width: 800px;
    width: 100%;
    min-height: 500px;
    overflow: hidden;
    position: relative;
}

/* ===== HEADER ===== */
.header {
    background: linear-gradient(to bottom, #fff, #f8f9fa);
    padding: 20px;
    text-align: center;
    border-bottom: 2px solid #dee2e6;
}

#phase-title {
    color: #212529;
    font-size: 1.5rem;
    text-transform: uppercase;
    letter-spacing: 2px;
}

/* ===== CONTE√öDO ===== */
#content-area {
    padding: 40px;
    text-align: center;
}

.phase {
    display: none;
}

.phase.active {
    display: block;
    animation: fadeIn 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ===== LUME (flutua) ===== */
.lume-char {
    font-size: 6rem;
    display: inline-block;
    animation: float 3s ease-in-out infinite;
    filter: drop-shadow(0 0 30px var(--lume-glow));
    margin-bottom: 20px;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}

/* ===== STORY BOX ===== */
.story-box {
    background: rgba(102, 126, 234, 0.1);
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 30px;
}

.story-box h1 {
    color: #212529;
    font-size: 2rem;
    margin-bottom: 15px;
}

.story-box p {
    font-size: 1.2rem;
    color: #6c757d;
    line-height: 1.8;
}

/* ===== QUESTION BOX ===== */
.question-box {
    background: rgba(102, 126, 234, 0.05);
    border: 2px solid #dee2e6;
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 30px;
}

.question-box h2 {
    color: #212529;
    font-size: 1.8rem;
    margin-bottom: 20px;
}

.question-box p {
    font-size: 1.1rem;
    color: #6c757d;
    margin-bottom: 20px;
}

/* ===== BOT√ïES ===== */
.btn {
    padding: 15px 40px;
    font-size: 1.1rem;
    font-weight: bold;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

.btn:active {
    transform: translateY(-1px);
}

.btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

/* ===== FEEDBACK ===== */
#feedback-zone {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 20px 30px;
    border-radius: 15px;
    font-weight: bold;
    font-size: 1.1rem;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.5s ease;
    z-index: 1000;
}

#feedback-zone.show {
    opacity: 1;
    transform: translateX(0);
}

#feedback-zone.correct {
    background: var(--correct);
    color: white;
}

#feedback-zone.wrong {
    background: var(--wrong);
    color: white;
}

/* ===== SCORE ===== */
.score-container {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(255, 255, 255, 0.9);
    padding: 15px 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.score-item {
    display: flex;
    gap: 10px;
    margin-bottom: 5px;
    font-weight: bold;
    color: #212529;
}

.score-item:last-child {
    margin-bottom: 0;
}

#score, #correct-count {
    color: var(--lume-primary);
    transition: transform 0.2s;
}

/* ===== RESPONSIVO ===== */
@media (max-width: 768px) {
    .game-container {
        border-radius: 15px;
        min-height: 400px;
    }
    
    .lume-char {
        font-size: 4rem;
    }
    
    #content-area {
        padding: 20px;
    }
    
    .story-box, .question-box {
        padding: 25px;
    }
    
    .story-box h1, .question-box h2 {
        font-size: 1.5rem;
    }
    
    .btn {
        padding: 12px 30px;
        font-size: 1rem;
    }
    
    .score-container {
        top: 10px;
        left: 10px;
        padding: 10px 15px;
        font-size: 0.9rem;
    }
    
    #feedback-zone {
        top: 10px;
        right: 10px;
        padding: 15px 20px;
        font-size: 1rem;
    }
}

    </style>
</head>
<body>
    <div class="game-container">
        <!-- Header -->
        <div class="header">
            <h1 id="phase-title">BEM-VINDO!</h1>
        </div>

        <!-- Score -->
        <div class="score-container">
            <div class="score-item">
                Pontos: <span id="score">0</span>
            </div>
            <div class="score-item">
                Acertos: <span id="correct-count">0</span>
            </div>
        </div>

        <!-- Content Area -->
        <div id="content-area">
            <!-- Fase 0: Boas-vindas -->
            <div id="phase-0" class="phase active">
                <div class="lume-char">üåü</div>
                <div class="story-box">
                    <h1>üèÉ‚Äç‚ôÇÔ∏è Teste Persegui√ß√£o - IAlume Factory</h1>
                    <p>Teste da mec√¢nica de persegui√ß√£o: Lume foge do drag√£o da ignor√¢ncia!</p>
                    <button class="btn btn-primary" onclick="startAdventure()">
                        COME√áAR AVENTURA
                    </button>
                </div>
            </div>

            <!-- Fases din√¢micas -->
            
            <!-- Fase 1 -->
            <div id="phase-1" class="phase">
                <!-- Conte√∫do ser√° injetado dinamicamente pelo Game Engine -->
            </div>
            
            <!-- Fase 2 -->
            <div id="phase-2" class="phase">
                <!-- Conte√∫do ser√° injetado dinamicamente pelo Game Engine -->
            </div>
            
            <!-- Fase 3 -->
            <div id="phase-3" class="phase">
                <!-- Conte√∫do ser√° injetado dinamicamente pelo Game Engine -->
            </div>
            
            <!-- Fase 4 -->
            <div id="phase-4" class="phase">
                <!-- Conte√∫do ser√° injetado dinamicamente pelo Game Engine -->
            </div>
            
            <!-- Fase 5 -->
            <div id="phase-5" class="phase">
                <!-- Conte√∫do ser√° injetado dinamicamente pelo Game Engine -->
            </div>
            
        </div>

        <!-- Feedback Zone -->
        <div id="feedback-zone"></div>
    </div>

    <script>
        
            // ========== BASE SCRIPTS ==========
            
// ===== base.js =====
// ESTADO DO JOGO
let gameState = {
    currentPhase: 0,
    score: 0,
    correctAnswers: 0,
    startTime: Date.now(),
    totalPhases: 4
};

// WEB AUDIO API
let audioContext;

function initAudio() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
}

function playSound(type) {
    initAudio();
    
    const frequencies = {
        success: [523.25, 659.25, 783.99],
        error: [349.23, 293.66],
        victory: [523.25, 659.25, 783.99, 1046.50],
        click: [440]
    };
    
    const notes = frequencies[type] || frequencies.click;
    
    notes.forEach((freq, index) => {
        setTimeout(() => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = freq;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        }, index * 100);
    });
}

// NAVEGACAO ENTRE FASES
function goToPhase(phaseNumber) {
    const phases = document.querySelectorAll('.phase');
    phases.forEach(phase => {
        phase.classList.remove('active');
    });
    
    const targetPhase = document.getElementById('phase-' + phaseNumber);
    if (targetPhase) {
        targetPhase.classList.add('active');
        gameState.currentPhase = phaseNumber;
        updatePhaseTitle(phaseNumber);
    } else {
        console.error('Fase ' + phaseNumber + ' nao encontrada!');
    }
}

function updatePhaseTitle(phaseNumber) {
    const titleElement = document.getElementById('phase-title');
    const titles = [
        'BEM-VINDO!',
        'FASE 1: DESCOBERTA',
        'FASE 2: COMPREENSAO',
        'FASE 3: APLICACAO',
        'FASE 4: CRIACAO'
    ];
    
    if (titleElement && titles[phaseNumber]) {
        titleElement.textContent = titles[phaseNumber];
    }
}

// FEEDBACK VISUAL
function showFeedback(message, type) {
    const feedbackZone = document.getElementById('feedback-zone');
    
    feedbackZone.textContent = message;
    feedbackZone.className = 'feedback ' + type + ' show';
    
    playSound(type === 'correct' ? 'success' : 'error');
    
    setTimeout(() => {
        feedbackZone.classList.remove('show');
    }, 3000);
}

// SISTEMA DE SCORE
function addScore(points) {
    gameState.score += points;
    const scoreElement = document.getElementById('score');
    if (scoreElement) {
        scoreElement.textContent = gameState.score;
        scoreElement.style.transform = 'scale(1.5)';
        setTimeout(() => {
            scoreElement.style.transform = 'scale(1)';
        }, 200);
    }
}

function incrementCorrect() {
    gameState.correctAnswers++;
    const correctElement = document.getElementById('correct-count');
    if (correctElement) {
        correctElement.textContent = gameState.correctAnswers;
    }
}

// ===== CALLBACK CENTRAL PARA TODAS AS MODALIDADES =====
/**
 * Fun√ß√£o centralizada chamada por TODAS as modalidades quando o usu√°rio responde.
 * Esta √© a PONTE entre modalidades, mec√¢nicas e Game Engine.
 *
 * FLUXO:
 * 1. Registra resultado no GAME_ENGINE (para estat√≠sticas finais)
 * 2. Atualiza UI de score (pontos e acertos)
 * 3. Dispara feedback visual da mec√¢nica (escalada, corrida, etc)
 * 4. Avan√ßa para pr√≥xima fase ap√≥s delay
 *
 * @param {boolean} isCorrect - Se a resposta est√° correta
 * @param {number} phaseNumber - N√∫mero da fase (1, 2, 3, 4, etc)
 */
function onAnswerChecked(isCorrect, phaseNumber) {
    console.log('üéØ onAnswerChecked chamado:', {
        isCorrect: isCorrect,
        phaseNumber: phaseNumber,
        timestamp: new Date().toISOString()
    });

    // 1Ô∏è‚É£ REGISTRAR NO GAME ENGINE (SEMPRE!)
    // Isso garante que os dados estar√£o dispon√≠veis em getFinalResult()
    const points = isCorrect ? 100 : 0;

    if (window.GAME_ENGINE && typeof GAME_ENGINE.recordResult === 'function') {
        GAME_ENGINE.recordResult(phaseNumber, isCorrect, points);
        console.log('‚úÖ Resultado registrado no Game Engine');
    } else {
        console.warn('‚ö†Ô∏è GAME_ENGINE.recordResult() n√£o encontrado! Dados n√£o ser√£o salvos.');
    }

    // 2Ô∏è‚É£ ATUALIZAR UI DE SCORE (gameState local + elementos DOM)
    if (isCorrect) {
        addScore(points);
        incrementCorrect();
        console.log('üìä Score atualizado:', gameState.score, 'pontos,', gameState.correctAnswers, 'acertos');
    }

    // 3Ô∏è‚É£ FEEDBACK VISUAL DA MEC√ÇNICA (se existir)
    // Suporta m√∫ltiplas mec√¢nicas: escalada, perseguicao, corrida, labirinto, etc
    if (window.ESCALADA) {
        console.log('üèîÔ∏è Acionando mec√¢nica ESCALADA');
        if (isCorrect) {
            ESCALADA.onCorrect();
        } else {
            ESCALADA.onWrong();
        }
    } else if (window.PERSEGUICAO) {
        console.log('üèÉ‚Äç‚ôÇÔ∏è Acionando mec√¢nica PERSEGUI√á√ÉO');
        if (isCorrect) {
            PERSEGUICAO.onCorrect();
        } else {
            PERSEGUICAO.onWrong();
        }
    } else if (window.CORRIDA) {
        console.log('üèÉ Acionando mec√¢nica CORRIDA');
        if (isCorrect) {
            CORRIDA.onCorrect();
        } else {
            CORRIDA.onWrong();
        }
    } else if (window.LABIRINTO) {
        console.log('üåÄ Acionando mec√¢nica LABIRINTO');
        if (isCorrect) {
            LABIRINTO.onCorrect();
        } else {
            LABIRINTO.onWrong();
        }
    } else {
        // Sem mec√¢nica = jogo linear simples
        console.log('‚è≠Ô∏è  Sem mec√¢nica visual (modo linear)');
    }

    // 4Ô∏è‚É£ PR√ìXIMA FASE (ap√≥s delay para anima√ß√µes)
    const delay = isCorrect ? 2500 : 3000;
    console.log('‚è±Ô∏è Avan√ßando para pr√≥xima fase em', delay, 'ms');

    setTimeout(() => {
        nextPhase();
    }, delay);
}

// Expor globalmente para as modalidades
window.onAnswerChecked = onAnswerChecked;

// ACOES DO JOGO - CORRIGIDO
function startAdventure() {
    playSound('click');
    console.log('üöÄ Aventura iniciada!');
    
    // Escalada j√° foi inicializada pelo Game Engine
    // Apenas ir para fase 1
    setTimeout(() => {
        goToPhase(1);
    }, 1500);
}

function nextPhase() {
    playSound('click');
    const nextPhaseNumber = gameState.currentPhase + 1;
    
    console.log('nextPhase chamado. Fase atual:', gameState.currentPhase, 'Proxima:', nextPhaseNumber);
    console.log('totalPhases:', gameState.totalPhases);
    
    if (nextPhaseNumber <= gameState.totalPhases) {
        // Apenas ir para pr√≥xima fase (o quiz j√° subiu o Lume)
        goToPhase(nextPhaseNumber);
    } else {
        console.log('Fim do jogo! Chamando GAME_ENGINE.finish()...');
        
        // USAR GAME_ENGINE.finish() em vez de showVictory()
        setTimeout(function() {
            if (window.GAME_ENGINE && typeof GAME_ENGINE.finish === 'function') {
                GAME_ENGINE.finish();
            } else {
                // Fallback: se GAME_ENGINE n√£o existir, usar showVictory
                console.warn('‚ö†Ô∏è GAME_ENGINE.finish() n√£o encontrado, usando showVictory()');
                showVictory();
            }
        }, 1000);
    }
}

function showVictory() {
    playSound('victory');
    
    const contentArea = document.getElementById('content-area');
    if (contentArea) {
        contentArea.style.display = 'none';
    }
    
    const gameContainer = document.querySelector('.game-container');
    
    const victoryHTML = `
        <div id="victory-overlay" style="
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        ">
            <div style="
                background: white;
                border-radius: 30px;
                padding: 40px 50px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                text-align: center;
                max-width: 600px;
                animation: scaleIn 0.5s ease;
            ">
                <div style="font-size: 5rem; margin-bottom: 15px;">
                    üèÜ
                </div>
                <h1 style="
                    font-size: 2.5rem;
                    color: #ffd700;
                    margin-bottom: 15px;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
                ">
                    VITORIA!
                </h1>
                <p style="
                    font-size: 1.3rem;
                    color: #212529;
                    margin-bottom: 25px;
                ">
                    Voce completou todas as fases!
                </p>
                <div style="
                    background: rgba(102, 126, 234, 0.1);
                    border-radius: 15px;
                    padding: 25px;
                    margin-bottom: 25px;
                ">
                    <div style="margin-bottom: 15px;">
                        <span style="font-size: 1.2rem; font-weight: bold;">Pontos finais:</span>
                        <span style="font-size: 2rem; color: #ffd700; margin-left: 10px;">
                            ${gameState.score}
                        </span>
                    </div>
                    <div>
                        <span style="font-size: 1.2rem; font-weight: bold;">Acertos:</span>
                        <span style="font-size: 2rem; color: #51cf66; margin-left: 10px;">
                            ${gameState.correctAnswers}
                        </span>
                    </div>
                </div>
                <button onclick="location.reload()" style="
                    padding: 20px 50px;
                    font-size: 1.2rem;
                    font-weight: bold;
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    border: none;
                    border-radius: 50px;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    transition: transform 0.3s ease;
                ">
                    JOGAR NOVAMENTE
                </button>
            </div>
        </div>
        
        <style>
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            @keyframes scaleIn {
                from { transform: scale(0.8); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            
            #victory-overlay button:hover {
                transform: translateY(-3px) scale(1.05);
            }
        </style>
    `;
    
    gameContainer.insertAdjacentHTML('beforeend', victoryHTML);
    
    console.log('Jogo completo!');
    console.log('Score final:', gameState.score);
    console.log('Acertos:', gameState.correctAnswers);
}

function concludeGame() {
    console.log('Concluindo jogo...');
    
    if (window.ESCALADA && ESCALADA.currentStep < ESCALADA.totalSteps - 1) {
        console.log('Subindo Lume para o topo...');
        ESCALADA.climb();
        
        setTimeout(() => {
            showVictory();
        }, 1500);
    } else {
        console.log('Lume ja esta no topo!');
        showVictory();
    }
}

// VALIDACAO DE RESPOSTA GENERICA
function checkAnswer(userAnswer, correctAnswer, tolerance) {
    tolerance = tolerance || 0;
    let isCorrect = false;
    
    if (typeof userAnswer === 'number' && typeof correctAnswer === 'number') {
        isCorrect = Math.abs(userAnswer - correctAnswer) <= tolerance;
    } else {
        isCorrect = userAnswer === correctAnswer;
    }
    
    if (isCorrect) {
        showFeedback('Correto! Muito bem!', 'correct');
        addScore(100);
        incrementCorrect();
        
        if (window.ESCALADA) {
            ESCALADA.onCorrect();
        }
        
        setTimeout(() => {
            nextPhase();
        }, 2000);
    } else {
        showFeedback('Ops! Tente novamente.', 'wrong');
        
        if (window.ESCALADA) {
            ESCALADA.onWrong();
        }
    }
    
    return isCorrect;
}
// TESTE GIT - linha adicionada


// ===== game-engine.js =====
// ===== MOTOR DO JOGO - GAME ENGINE (VERS√ÉO FINAL CORRIGIDA) =====

const GAME_ENGINE = {
    config: null,
    currentPhaseIndex: 0,
    results: [],
    
    // Inicializar jogo com configura√ß√£o
    init: function(gameConfig) {
        console.log('üéÆ Iniciando Game Engine...', gameConfig);
        
        this.config = gameConfig;
        this.currentPhaseIndex = 0;
        this.results = [];
        
        // Validar configura√ß√£o
        if (!this.validateConfig(gameConfig)) {
            console.error('‚ùå Configura√ß√£o inv√°lida!');
            return false;
        }
        
        // Configurar sistema base
        window.totalPhases = gameConfig.fases.length;
        
        // CORRE√á√ÉO DEFINITIVA: Total de andares = n√∫mero de fases
        // O array fases[] J√Å inclui a fase 0 (boas-vindas), ent√£o N√ÉO soma +1
        const totalSteps = gameConfig.fases.length;
        
        console.log('üìä Total de fases no array:', gameConfig.fases.length);
        console.log('üèîÔ∏è Total de andares na escalada:', totalSteps);
        console.log('‚úÖ C√°lculo correto: fases.length =', totalSteps, '(fase 0 j√° est√° inclu√≠da)');
        
        // Configurar mec√¢nica (se existir e n√£o for 'none') - ANTES de injetar fases
        if (gameConfig.mecanica && gameConfig.mecanica !== 'none') {
            const Mechanic = this.getMechanic(gameConfig.mecanica);
            if (Mechanic) {
                console.log('üéÆ Inicializando mec√¢nica:', gameConfig.mecanica);
                Mechanic.init({
                    totalSteps: totalSteps
                });
            } else {
                console.warn('‚ö†Ô∏è Mec√¢nica n√£o encontrada:', gameConfig.mecanica);
            }
        } else {
            console.log('‚è≠Ô∏è  Jogo linear (sem mec√¢nica visual)');
        }
        
        // Injetar todas as fases
        this.injectAllPhases();
        
        console.log('‚úÖ Game Engine inicializado!');
        return true;
    },
    
    // Validar configura√ß√£o
    validateConfig: function(config) {
        if (!config) {
            console.error('Config √© null/undefined');
            return false;
        }
        
        if (!config.fases || !Array.isArray(config.fases)) {
            console.error('Fases n√£o √© um array');
            return false;
        }
        
        if (config.fases.length === 0) {
            console.error('Nenhuma fase definida');
            return false;
        }
        
        // Validar cada fase
        for (let i = 0; i < config.fases.length; i++) {
            const fase = config.fases[i];
            
            // ‚úÖ PULAR FASE 0 (boas-vindas) - Ela √© est√°tica no HTML
            if (i === 0 && (fase.type === 'welcome' || !fase.modalidade)) {
                console.log('‚è≠Ô∏è Fase 0 (boas-vindas) detectada - pulando valida√ß√£o');
                continue;
            }
            
            if (!fase.modalidade) {
                console.error('Fase ' + (i+1) + ' sem modalidade');
                return false;
            }
            
            if (!this.getModalidade(fase.modalidade)) {
                console.error('Modalidade n√£o existe: ' + fase.modalidade);
                return false;
            }
        }
        
        return true;
    },
    
    // Injetar todas as fases
    injectAllPhases: function() {
        console.log('üì¶ Injetando fases...');
        
        let numeroFase = 1; // ‚úÖ Contador separado come√ßa em 1
        
        this.config.fases.forEach((faseConfig, index) => {
            // ‚úÖ PULAR FASE 0 (boas-vindas) - Ela j√° est√° no HTML
            if (index === 0 && (faseConfig.type === 'welcome' || !faseConfig.modalidade)) {
                console.log('‚è≠Ô∏è Fase 0 (boas-vindas) - usando conte√∫do est√°tico do HTML');
                return; // Pula essa fase, numeroFase continua 1
            }
            
            // ‚úÖ Usa numeroFase (contador), n√£o index+1
            console.log('üì¶ Injetando fase', index, 'no elemento phase-' + numeroFase);
            this.injectPhase(numeroFase, faseConfig);
            numeroFase++; // Incrementa s√≥ quando injeta
        });
        
        console.log('‚úÖ Todas as fases injetadas!');
    },
    
    // Injetar uma fase espec√≠fica
    injectPhase: function(numeroFase, faseConfig) {
        const faseElement = document.getElementById('phase-' + numeroFase);
        
        if (!faseElement) {
            console.error('Elemento phase-' + numeroFase + ' n√£o encontrado!');
            return;
        }
        
        // Limpar fase
        faseElement.innerHTML = '';
        
        // Obter modalidade
        const Modalidade = this.getModalidade(faseConfig.modalidade);
        
        if (!Modalidade) {
            console.error('Modalidade n√£o encontrada: ' + faseConfig.modalidade);
            faseElement.innerHTML = '<p style="color:red;">Erro: Modalidade n√£o encontrada</p>';
            return;
        }
        
        // Criar UI da modalidade
        const ui = Modalidade.createUI(faseConfig.dados);
        faseElement.appendChild(ui);
        
        console.log('‚úÖ Fase ' + numeroFase + ' injetada (' + faseConfig.modalidade + ')');
    },
    
    // Obter objeto da modalidade
    getModalidade: function(nome) {
        const modalidades = {
            'quiz': window.QUIZ,
            'true-false': window.TRUE_FALSE,
            'verdadeiro-falso': window.TRUE_FALSE,
            'fill-blanks': window.FILL_BLANKS,
            'lacunas': window.FILL_BLANKS,
            'sequence': window.SEQUENCE,
            'sequencia': window.SEQUENCE
        };
        
        return modalidades[nome.toLowerCase()];
    },
    
    // Obter objeto da mec√¢nica
    getMechanic: function(nome) {
        const mechanics = {
            'escalada': window.ESCALADA,
            'perseguicao': window.PERSEGUICAO,
            'corrida': window.CORRIDA,  // futuro
            'labirinto': window.LABIRINTO  // futuro
        };

        return mechanics[nome.toLowerCase()];
    },
    
    // Registrar resultado de uma fase
    recordResult: function(phaseNumber, correct, points) {
        this.results.push({
            fase: phaseNumber,
            acertou: correct,
            pontos: points,
            timestamp: new Date().toISOString()
        });
        
        console.log('üìä Resultado registrado:', this.results[this.results.length - 1]);
    },
    
    // Obter resultado final
    getFinalResult: function() {
        const totalFases = this.results.length;
        const acertos = this.results.filter(r => r.acertou).length;
        const pontosTotais = this.results.reduce((sum, r) => sum + r.pontos, 0);
        
        return {
            tema: this.config.tema || 'Sem tema',
            totalFases: totalFases,
            acertos: acertos,
            erros: totalFases - acertos,
            pontosTotais: pontosTotais,
            percentualAcerto: Math.round((acertos / totalFases) * 100),
            detalhes: this.results,
            timestamp: new Date().toISOString()
        };
    },
    
    // Finalizar jogo
    finish: function() {
        const resultado = this.getFinalResult();
        
        console.log('üèÅ JOGO FINALIZADO!', resultado);
        
        // Salvar no localStorage (tempor√°rio)
        localStorage.setItem('ultimo_resultado', JSON.stringify(resultado));
        
        // Callback para Bubble (se existir)
        if (window.sendResultToBubble) {
            window.sendResultToBubble(resultado);
        }
        
        // Mostrar tela final
        this.showFinalScreen(resultado);
        
        return resultado;
    },
    
    // Mostrar tela final
    showFinalScreen: function(resultado) {
        const container = document.getElementById('phase-' + window.totalPhases);
        
        if (!container) return;
        
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 20px; color: white;">
                <h1 style="font-size: 2.5rem; margin-bottom: 20px;">üéâ PARAB√âNS!</h1>
                <h2 style="font-size: 1.8rem; margin-bottom: 30px;">${resultado.tema}</h2>
                
                <div style="background: rgba(255,255,255,0.2); border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                    <div style="font-size: 3rem; font-weight: 700; margin-bottom: 10px;">
                        ${resultado.pontosTotais} PONTOS
                    </div>
                    <div style="font-size: 1.3rem;">
                        ‚úÖ ${resultado.acertos} acertos | ‚ùå ${resultado.erros} erros
                    </div>
                    <div style="font-size: 1.5rem; margin-top: 15px; font-weight: 600;">
                        ${resultado.percentualAcerto}% de aproveitamento
                    </div>
                </div>
                
                <button onclick="location.reload()" style="
                    padding: 20px 40px;
                    font-size: 1.3rem;
                    font-weight: 700;
                    background: white;
                    color: #667eea;
                    border: none;
                    border-radius: 15px;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                ">
                    üîÑ JOGAR NOVAMENTE
                </button>
            </div>
        `;
    }
};

// Expor globalmente
window.GAME_ENGINE = GAME_ENGINE;

console.log('üéÆ game-engine.js carregado!');


// ===== questoes.js =====
// ===== BANCO DE QUESTOES =====

// QUIZ - Multipla Escolha
const QUESTOES_MATEMATICA = [
    {
        pergunta: "Quanto e 5 x 3?",
        alternativas: ["12", "15", "18", "20"],
        correta: 1,
        feedback_correto: "Perfeito! 5 x 3 = 15",
        feedback_errado: "Ops! Revise a tabuada do 5."
    },
    {
        pergunta: "Quanto e 20 / 4?",
        alternativas: ["3", "4", "5", "6"],
        correta: 2,
        feedback_correto: "Isso mesmo! 20 / 4 = 5",
        feedback_errado: "Tente dividir novamente!"
    },
    {
        pergunta: "Quanto e 8 + 7?",
        alternativas: ["13", "14", "15", "16"],
        correta: 2,
        feedback_correto: "Excelente! 8 + 7 = 15",
        feedback_errado: "Quase la! Some de novo."
    },
    {
        pergunta: "Quanto e 12 - 5?",
        alternativas: ["5", "6", "7", "8"],
        correta: 2,
        feedback_correto: "Parabens! 12 - 5 = 7",
        feedback_errado: "Revise a subtracao!"
    }
];

// VERDADEIRO OU FALSO
const QUESTOES_VERD_FALSO = [
    {
        afirmacao: "A agua ferve a 100 graus ao nivel do mar.",
        correta: true,
        feedback_correto: "Correto! A 100 graus ao nivel do mar",
        feedback_errado: "Na verdade, a agua ferve a 100 graus ao nivel do mar!"
    },
    {
        afirmacao: "O Sol gira em torno da Terra.",
        correta: false,
        feedback_correto: "Exato! A Terra gira em torno do Sol",
        feedback_errado: "Ops! A Terra que gira em torno do Sol!"
    },
    {
        afirmacao: "O coracao humano tem 4 camaras.",
        correta: true,
        feedback_correto: "Isso mesmo! 2 atrios e 2 ventriculos",
        feedback_errado: "Na verdade, o coracao tem SIM 4 camaras!"
    },
    {
        afirmacao: "A capital do Brasil e Sao Paulo.",
        correta: false,
        feedback_correto: "Correto! A capital e Brasilia",
        feedback_errado: "Ops! A capital do Brasil e Brasilia!"
    }
];

// PREENCHER LACUNAS
const QUESTOES_LACUNAS = [
    {
        frase: "O Brasil foi descoberto em ____.",
        resposta: "1500",
        variacoes_aceitas: ["1500"],
        dica: "Seculo XVI",
        feedback_correto: "Isso mesmo! Em 1500 por Pedro Alvares Cabral",
        feedback_errado: "O Brasil foi descoberto em 1500!"
    },
    {
        frase: "A capital do Brasil e ____.",
        resposta: "Brasilia",
        variacoes_aceitas: ["Brasilia", "brasilia"],
        dica: "Fica no Distrito Federal",
        feedback_correto: "Correto! Brasilia, inaugurada em 1960",
        feedback_errado: "A capital do Brasil e Brasilia!"
    },
    {
        frase: "A agua e composta por hidrogenio e ____.",
        resposta: "oxigenio",
        variacoes_aceitas: ["oxigenio", "O2"],
        dica: "H2O - O elemento O",
        feedback_correto: "Exato! H2O = 2 hidrogenios + 1 oxigenio",
        feedback_errado: "A agua e H2O: hidrogenio e oxigenio!"
    },
    {
        frase: "O maior planeta do Sistema Solar e ____.",
        resposta: "Jupiter",
        variacoes_aceitas: ["Jupiter", "jupiter"],
        dica: "Gigante gasoso",
        feedback_correto: "Isso! Jupiter e enorme!",
        feedback_errado: "O maior planeta e Jupiter!"
    }
];

// ORDENAR SEQUENCIA
const QUESTOES_SEQUENCIA = [
    {
        instrucao: "Ordene os planetas do mais proximo ao mais distante do Sol:",
        itens: ["Mercurio", "Venus", "Terra", "Marte"],
        ordem_correta: ["Mercurio", "Venus", "Terra", "Marte"],
        feedback_correto: "Perfeito! Essa e a ordem correta dos planetas!",
        feedback_errado: "Ops! Veja a ordem correta dos planetas."
    },
    {
        instrucao: "Ordene os numeros do menor para o maior:",
        itens: ["10", "3", "7", "1"],
        ordem_correta: ["1", "3", "7", "10"],
        feedback_correto: "Exato! Ordem crescente correta!",
        feedback_errado: "Quase! A ordem crescente e diferente."
    }
];

// Funcao para injetar quiz em uma fase
function injetarQuizNaFase(numeroFase, questao) {
    const fase = document.getElementById('phase-' + numeroFase);
    if (!fase) {
        console.error('Fase ' + numeroFase + ' nao encontrada!');
        return;
    }
    
    fase.innerHTML = '';
    const quizUI = QUIZ.createUI(questao);
    fase.appendChild(quizUI);
    
    console.log('Quiz injetado na Fase ' + numeroFase);
}

// Expor globalmente
window.QUESTOES_MATEMATICA = QUESTOES_MATEMATICA;
window.QUESTOES_VERD_FALSO = QUESTOES_VERD_FALSO;
window.QUESTOES_LACUNAS = QUESTOES_LACUNAS;
window.QUESTOES_SEQUENCIA = QUESTOES_SEQUENCIA;
window.injetarQuizNaFase = injetarQuizNaFase;

console.log('questoes.js carregado!');


// ===== bubble-integration.js =====
// ===== BUBBLE INTEGRATION =====
// C√≥digo de integra√ß√£o com Bubble.io
// Injeta CONFIG, envia resultados, auto-close

// ========== CONFIGURA√á√ÉO BUBBLE ==========
const BUBBLE_CONFIG = {
    bubbleApiUrl: 'https://ialume.bubbleapps.io/api/1.1',
    bubbleApiKey: '%%BUBBLE_API_KEY%%',  // Substituir no Bubble
    paginaId: null,
    sessaoId: null,
    alunoId: null
};

// ========== LER PAR√ÇMETROS DA URL ==========
function initBubbleParams() {
    console.log('üîó Inicializando par√¢metros Bubble...');
    
    const params = getURLParams();
    console.log('üìã URL Params:', params);
    
    // Configurar IDs
    if (params.pagina_id) {
        BUBBLE_CONFIG.paginaId = params.pagina_id;
        console.log('‚úÖ pagina_id:', BUBBLE_CONFIG.paginaId);
    }
    if (params.sessao_id) {
        BUBBLE_CONFIG.sessaoId = params.sessao_id;
        console.log('‚úÖ sessao_id:', BUBBLE_CONFIG.sessaoId);
    }
    if (params.aluno_id) {
        BUBBLE_CONFIG.alunoId = params.aluno_id;
        console.log('‚úÖ aluno_id:', BUBBLE_CONFIG.alunoId);
    }
    
    // Verificar API Key
    if (BUBBLE_CONFIG.bubbleApiKey.includes('%%')) {
        console.warn('‚ö†Ô∏è API Key n√£o configurada! Rodando em modo demo.');
    } else {
        console.log('‚úÖ API Key configurada');
    }
}

function getURLParams() {
    const inIframe = window.self !== window.top;
    let search = '';
    
    try {
        if (inIframe) {
            console.log('üîç Detectado iframe, lendo URL da janela pai');
            search = window.parent.location.search;
        } else {
            search = window.location.search;
        }
    } catch (e) {
        console.warn('‚ö†Ô∏è Erro ao acessar parent:', e.message);
        search = window.location.search;
    }
    
    if (!search || search === '') {
        try {
            const href = inIframe ? window.parent.location.href : window.location.href;
            const questionMarkIndex = href.indexOf('?');
            if (questionMarkIndex !== -1) {
                search = href.substring(questionMarkIndex);
            }
        } catch (e) {
            console.warn('‚ö†Ô∏è N√£o conseguiu extrair params:', e.message);
        }
    }
    
    const params = new URLSearchParams(search);
    const result = {};
    for (const [key, value] of params) {
        if (value && value !== '') {
            result[key] = value;
        }
    }
    
    return result;
}

// ========== ENVIAR RESULTADO PARA BUBBLE ==========
function sendResultToBubble(resultado) {
    if (!BUBBLE_CONFIG.bubbleApiUrl || !BUBBLE_CONFIG.bubbleApiKey) {
        console.warn('‚ö†Ô∏è API Bubble n√£o configurada');
        console.log('Resultado (n√£o enviado):', resultado);
        return;
    }

    if (BUBBLE_CONFIG.bubbleApiKey.includes('%%')) {
        console.warn('‚ö†Ô∏è API Key placeholder - n√£o enviando');
        return;
    }

    // Formatar dados para Bubble
    const bubbleData = {
        pagina: BUBBLE_CONFIG.paginaId,
        sessao: BUBBLE_CONFIG.sessaoId,
        aluno: BUBBLE_CONFIG.alunoId,
        pontos: resultado.pontosTotais || resultado.pontos || 0,
        acertos: resultado.acertos || 0,
        erros: resultado.erros || 0,
        percentual: resultado.percentualAcerto || resultado.percentual || 0,
        total_fases: resultado.totalFases || 0,
        detalhes: JSON.stringify(resultado.detalhes || []),
        data_jogo: resultado.timestamp || new Date().toISOString()
    };

    console.log('üì§ Enviando para Bubble:', bubbleData);

    fetch(BUBBLE_CONFIG.bubbleApiUrl + '/obj/resultado_jogo', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + BUBBLE_CONFIG.bubbleApiKey
        },
        body: JSON.stringify(bubbleData)
    })
    .then(response => {
        console.log('üì• Resposta HTTP:', response.status);
        if (!response.ok) {
            throw new Error('HTTP ' + response.status);
        }
        return response.json();
    })
    .then(data => {
        console.log('‚úÖ Resultado salvo no Bubble!', data);
    })
    .catch(error => {
        console.error('‚ùå Erro ao enviar resultado:', error);
    });
}

// ========== TELA DE VIT√ìRIA BUBBLE ==========
function showVictoryBubble(resultado) {
    console.log('üéâ Mostrando tela de vit√≥ria Bubble...');
    
    const contentArea = document.getElementById('content-area');
    if (contentArea) {
        contentArea.style.display = 'none';
    }
    
    const gameContainer = document.querySelector('.game-container');
    if (!gameContainer) {
        console.error('‚ùå game-container n√£o encontrado!');
        return;
    }
    
    const victoryHTML = `
        <div id="victory-overlay" style="
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        ">
            <div style="
                background: white;
                border-radius: 30px;
                padding: 40px 50px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                text-align: center;
                max-width: 600px;
                animation: scaleIn 0.5s ease;
            ">
                <div style="font-size: 5rem; margin-bottom: 15px;">
                    üèÜ
                </div>
                <h1 style="
                    font-size: 2.5rem;
                    color: #ffd700;
                    margin-bottom: 15px;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
                ">
                    VITORIA!
                </h1>
                <p style="
                    font-size: 1.3rem;
                    color: #212529;
                    margin-bottom: 25px;
                ">
                    Voce completou todas as fases!
                </p>
                <div style="
                    background: rgba(102, 126, 234, 0.1);
                    border-radius: 15px;
                    padding: 25px;
                    margin-bottom: 25px;
                ">
                    <div style="margin-bottom: 15px;">
                        <span style="font-size: 1.2rem; font-weight: bold;">Pontos finais:</span>
                        <span style="font-size: 2rem; color: #ffd700; margin-left: 10px;">
                            ${resultado.pontosTotais || resultado.pontos || 0}
                        </span>
                    </div>
                    <div>
                        <span style="font-size: 1.2rem; font-weight: bold;">Acertos:</span>
                        <span style="font-size: 2rem; color: #51cf66; margin-left: 10px;">
                            ${resultado.acertos || 0}
                        </span>
                    </div>
                </div>
                <button id="btn-voltar" style="
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    border: none;
                    padding: 20px 50px;
                    font-size: 1.2rem;
                    font-weight: bold;
                    border-radius: 50px;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    transition: transform 0.3s ease;
                    margin-bottom: 20px;
                ">
                    üè† VOLTAR
                </button>
                <div id="countdown" style="font-size: 1rem; opacity: 0.6;">
                    Voltando automaticamente em <span id="seconds">10</span>s
                </div>
            </div>
        </div>
        
        <style>
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            @keyframes scaleIn {
                from { transform: scale(0.8); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            
            #btn-voltar:hover {
                transform: translateY(-3px) scale(1.05);
            }
        </style>
    `;
    
    gameContainer.insertAdjacentHTML('beforeend', victoryHTML);
    
    // Event listener para bot√£o VOLTAR
    const btnVoltar = document.getElementById('btn-voltar');
    if (btnVoltar) {
        btnVoltar.addEventListener('click', function() {
            console.log('üè† Bot√£o VOLTAR clicado');
            window.location.href = '/index/7';
        });
    }
    
    // Auto-redirect ap√≥s 10 segundos
    let seconds = 10;
    const countdownInterval = setInterval(function() {
        seconds--;
        const secondsEl = document.getElementById('seconds');
        if (secondsEl) {
            secondsEl.textContent = seconds;
        }
        
        if (seconds <= 0) {
            clearInterval(countdownInterval);
            console.log('‚è±Ô∏è Tempo esgotado - redirecionando para /index/7');
            window.location.href = '/index/7';
        }
    }, 1000);
}

// ========== INICIALIZA√á√ÉO ==========
function setupBubbleIntegration() {
    console.log('üîó Inicializando par√¢metros Bubble...');
    initBubbleParams();
    
    // Fazer override IMEDIATAMENTE
    overrideGameEngineFinish();
}

// ========== OVERRIDE DO GAME ENGINE ==========
// Wrapper que intercepta o finish() SEMPRE
function overrideGameEngineFinish() {
    // Criar um interval que verifica se GAME_ENGINE existe
    const checkInterval = setInterval(function() {
        if (window.GAME_ENGINE && typeof window.GAME_ENGINE.finish === 'function') {
            clearInterval(checkInterval);
            
            console.log('‚úÖ GAME_ENGINE encontrado! Aplicando override Bubble...');
            
            // Guardar refer√™ncia ao m√©todo original
            const originalFinish = GAME_ENGINE.finish;
            
            // Sobrescrever com vers√£o Bubble
            GAME_ENGINE.finish = function() {
                console.log('üèÅ JOGO FINALIZADO (MODO BUBBLE)!');
                
                const resultado = this.getFinalResult();
                console.log('üìä Resultado:', resultado);
                
                // Enviar para Bubble
                console.log('üì§ Tentando enviar para Bubble...');
                sendResultToBubble(resultado);
                
                // Mostrar tela Bubble
                console.log('üéâ Mostrando tela de vit√≥ria Bubble...');
                showVictoryBubble(resultado);
                
                return resultado;
            };
            
            console.log('‚úÖ Game Engine.finish() SOBRESCRITO para modo Bubble');
        }
    }, 50); // Verifica a cada 50ms
    
    // Timeout de seguran√ßa (10 segundos)
    setTimeout(function() {
        clearInterval(checkInterval);
    }, 10000);
}

// Inicializar assim que poss√≠vel
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupBubbleIntegration);
} else {
    setupBubbleIntegration();
}

console.log('üîó bubble-integration.js carregado!');


            
            // ========== MECHANIC ==========
            // ===== MEC√ÇNICA: PERSEGUI√á√ÉO/FUGA =====
// Lume foge horizontalmente de um perigo (drag√£o da ignor√¢ncia)

const PERSEGUICAO = {
    name: 'perseguicao',
    currentStep: 0,
    totalSteps: 5, // Fase 0-4
    lumePosition: 20, // Come√ßa em 20% da esquerda
    dangerPosition: 0, // Perigo come√ßa em 0%

    // Inicializar mec√¢nica
    init: function(config) {
        console.log('üèÉ‚Äç‚ôÇÔ∏è PERSEGUICAO.init() chamado com config:', config);

        if (!config || !config.totalSteps) {
            console.error('‚ùå ERRO: config.totalSteps n√£o fornecido!');
            return;
        }

        this.totalSteps = config.totalSteps;
        this.currentStep = 0;
        this.lumePosition = 20; // Reset
        this.dangerPosition = 0; // Reset

        console.log('‚úÖ Mec√¢nica PERSEGUI√á√ÉO inicializada');
        console.log('   Total de fases:', this.totalSteps);
        console.log('   Fase atual:', this.currentStep);
        console.log('   Posi√ß√£o inicial de Lume:', this.lumePosition + '%');
        console.log('   Posi√ß√£o inicial do perigo:', this.dangerPosition + '%');

        this.injectHTML();
        this.injectCSS();
        this.updatePositions();
    },

    // Injetar HTML da pista de fuga
    injectHTML: function() {
        const container = document.querySelector('.game-container');

        // Criar container da mec√¢nica
        const mechanicHTML = `
            <div id="perseguicao-container" class="mechanic-container">
                <!-- Pista/Caminho -->
                <div class="chase-track">
                    <!-- Marcadores de progresso -->
                    <div class="progress-markers">
                        ${this.generateMarkers()}
                    </div>

                    <!-- Linha de perigo (quando perigo alcan√ßa, game over) -->
                    <div class="danger-line" id="danger-line"></div>
                </div>

                <!-- Lume fugindo -->
                <div id="lume-runner" class="lume-runner">
                    üåü
                </div>

                <!-- Perigo perseguindo -->
                <div id="danger-chaser" class="danger-chaser">
                    üêâ
                </div>

                <!-- Zona segura (chegada) -->
                <div class="safe-zone">
                    <div class="safe-zone-flag">üèÅ</div>
                    <span class="safe-zone-label">SEGURAN√áA!</span>
                </div>
            </div>
        `;

        container.insertAdjacentHTML('beforeend', mechanicHTML);
    },

    // Gerar marcadores de progresso
    generateMarkers: function() {
        console.log('üìç Gerando marcadores de progresso...');

        // Calcular posi√ß√µes din√¢micas baseadas no movimento real
        // Lume come√ßa em 20% e avan√ßa 15% por fase jog√°vel
        const startPosition = 20;
        const advancePerStep = 15;
        const playablePhases = this.totalSteps - 1; // -1 porque fase 0 √© welcome

        console.log('   Fases jog√°veis:', playablePhases);
        console.log('   Posi√ß√£o inicial:', startPosition + '%');
        console.log('   Avan√ßo por fase:', advancePerStep + '%');

        let markersHTML = '';

        // Gerar marcador para cada posi√ß√£o que Lume alcan√ßa
        for (let i = 0; i <= playablePhases; i++) {
            const position = startPosition + (i * advancePerStep);

            let label;
            if (i === 0) {
                label = 'IN√çCIO';
            } else if (i === playablePhases) {
                label = 'META';
            } else {
                label = `${position}%`;
            }

            console.log(`   Marcador ${i}: ${position}% (${label})`);

            markersHTML += `
                <div class="marker" style="left: ${position}%">
                    <div class="marker-line"></div>
                    <span class="marker-label">${label}</span>
                </div>
            `;
        }

        console.log('‚úÖ Marcadores gerados!');
        return markersHTML;
    },

    // Injetar CSS
    injectCSS: function() {
        if (document.getElementById('perseguicao-styles')) return;

        console.log('üé® Criando CSS para mec√¢nica de persegui√ß√£o');

        const style = document.createElement('style');
        style.id = 'perseguicao-styles';
        style.textContent = `
            /* Container da mec√¢nica */
            #perseguicao-container {
                position: fixed;
                left: 40px;
                right: 40px;
                bottom: 40px;
                height: 150px;
                z-index: 100;
                pointer-events: none;
            }

            /* Pista de fuga */
            .chase-track {
                position: absolute;
                bottom: 60px;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(to right,
                    #ff4444 0%,
                    #ffaa00 20%,
                    #ffff00 40%,
                    #88ff00 60%,
                    #00ff00 80%,
                    #00ff00 100%
                );
                border-radius: 2px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            }

            /* Marcadores de progresso */
            .progress-markers {
                position: absolute;
                top: -30px;
                left: 0;
                right: 0;
                height: 30px;
            }

            .marker {
                position: absolute;
                transform: translateX(-50%);
            }

            .marker-line {
                width: 2px;
                height: 20px;
                background: rgba(255,255,255,0.5);
                margin: 0 auto;
            }

            .marker-label {
                display: block;
                font-size: 0.6rem;
                color: rgba(255,255,255,0.8);
                text-align: center;
                margin-top: 2px;
                white-space: nowrap;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            }

            /* Linha de perigo */
            .danger-line {
                position: absolute;
                left: 70%;
                top: -10px;
                bottom: -10px;
                width: 2px;
                background: rgba(255,0,0,0.3);
                border-left: 2px dashed rgba(255,0,0,0.6);
            }

            /* Lume correndo */
            .lume-runner {
                position: absolute;
                left: 20%;
                bottom: 30px;
                font-size: 3rem;
                filter: drop-shadow(0 0 20px #fff8dc);
                transition: left 1s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                            transform 0.3s ease;
                z-index: 103;
                pointer-events: none;
            }

            /* Perigo perseguindo */
            .danger-chaser {
                position: absolute;
                left: 0%;
                bottom: 30px;
                font-size: 3rem;
                filter: drop-shadow(0 0 20px #ff4444);
                transition: left 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                            transform 0.3s ease;
                z-index: 102;
                pointer-events: none;
                animation: dangerFloat 2s ease-in-out infinite;
            }

            @keyframes dangerFloat {
                0%, 100% { transform: translateY(0) scale(1); }
                50% { transform: translateY(-10px) scale(1.1); }
            }

            /* Zona segura (chegada) */
            .safe-zone {
                position: absolute;
                right: 10px;
                bottom: 20px;
                width: 80px;
                height: 100px;
                background: linear-gradient(to top,
                    rgba(0,255,0,0.2),
                    rgba(0,255,0,0.05)
                );
                border: 3px solid rgba(0,255,0,0.5);
                border-radius: 10px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 101;
            }

            .safe-zone-flag {
                font-size: 2.5rem;
                animation: wave 1s ease-in-out infinite;
            }

            .safe-zone-label {
                font-size: 0.7rem;
                font-weight: bold;
                color: #00ff00;
                text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
                margin-top: 5px;
            }

            @keyframes wave {
                0%, 100% { transform: rotate(-10deg); }
                50% { transform: rotate(10deg); }
            }

            /* Anima√ß√£o de corrida */
            .lume-runner.running {
                animation: run 0.8s ease-in-out;
            }

            @keyframes run {
                0%, 100% { transform: scale(1) rotate(0deg); }
                25% { transform: scale(1.15) rotate(-5deg); }
                50% { transform: scale(1.1) rotate(3deg); }
                75% { transform: scale(1.15) rotate(-3deg); }
            }

            /* Anima√ß√£o de avan√ßo do perigo */
            .danger-chaser.advancing {
                animation: dangerAdvance 1s ease-in-out;
            }

            @keyframes dangerAdvance {
                0%, 100% { transform: scale(1) translateY(0); }
                25% { transform: scale(1.2) translateY(-5px); }
                50% { transform: scale(1.15) translateY(0); }
                75% { transform: scale(1.2) translateY(-5px); }
            }

            /* Anima√ß√£o de tremor (erro) */
            @keyframes tremble {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                50% { transform: translateX(5px); }
                75% { transform: translateX(-5px); }
            }

            /* Part√≠culas ao correr */
            .run-particle {
                position: absolute;
                width: 8px;
                height: 8px;
                background: #ffd700;
                border-radius: 50%;
                pointer-events: none;
                animation: particleFade 0.8s ease-out forwards;
            }

            @keyframes particleFade {
                0% {
                    opacity: 1;
                    transform: translateX(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateX(-50px) scale(0);
                }
            }

            /* Efeito de vit√≥ria */
            .victory-burst {
                position: fixed;
                font-size: 2rem;
                z-index: 1000;
                pointer-events: none;
                animation: burstOut 1.5s ease-out forwards;
            }

            @keyframes burstOut {
                0% {
                    opacity: 1;
                    transform: translate(0, 0) scale(1) rotate(0deg);
                }
                100% {
                    opacity: 0;
                    transform: translate(var(--tx), var(--ty)) scale(0) rotate(360deg);
                }
            }

            /* Responsivo */
            @media (max-width: 768px) {
                #perseguicao-container {
                    left: 20px;
                    right: 20px;
                    bottom: 20px;
                    height: 120px;
                }

                .lume-runner,
                .danger-chaser {
                    font-size: 2rem;
                    bottom: 20px;
                }

                .safe-zone {
                    width: 60px;
                    height: 80px;
                }

                .safe-zone-flag {
                    font-size: 2rem;
                }

                .safe-zone-label {
                    font-size: 0.6rem;
                }

                .marker-label {
                    font-size: 0.5rem;
                }
            }
        `;

        document.head.appendChild(style);
    },

    // Atualizar posi√ß√µes de Lume e do perigo
    updatePositions: function() {
        const lume = document.getElementById('lume-runner');
        const danger = document.getElementById('danger-chaser');

        if (!lume || !danger) return;

        // Garantir que n√£o ultrapassa limites
        this.lumePosition = Math.max(0, Math.min(80, this.lumePosition));
        this.dangerPosition = Math.max(0, Math.min(70, this.dangerPosition));

        lume.style.left = this.lumePosition + '%';
        danger.style.left = this.dangerPosition + '%';

        console.log(`üèÉ‚Äç‚ôÇÔ∏è Posi√ß√µes - Lume: ${this.lumePosition}% | Perigo: ${this.dangerPosition}%`);
        console.log(`   Dist√¢ncia: ${this.lumePosition - this.dangerPosition}%`);

        // Verificar se perigo alcan√ßou Lume
        if (this.dangerPosition >= this.lumePosition - 5) {
            console.warn('‚ö†Ô∏è PERIGO MUITO PR√ìXIMO!');
            this.onDangerClose();
        }
    },

    // Lume avan√ßa (quando acerta)
    runForward: function() {
        console.log('‚¨ÜÔ∏è runForward() chamado. Fase atual:', this.currentStep, '/ Total:', this.totalSteps);

        if (this.currentStep >= this.totalSteps - 1) {
            console.log('üö´ Lume j√° completou todas as fases!');
            return;
        }

        this.currentStep++;

        // Avan√ßar 15% por acerto
        this.lumePosition += 15;

        console.log('‚úÖ Lume avan√ßou para:', this.lumePosition + '%');

        // Adicionar classe de anima√ß√£o
        const lume = document.getElementById('lume-runner');
        lume.classList.add('running');

        // Criar part√≠culas
        this.createRunParticles();

        // Atualizar posi√ß√£o
        this.updatePositions();

        // Remover classe ap√≥s anima√ß√£o
        setTimeout(() => {
            lume.classList.remove('running');
        }, 800);

        // Verificar se chegou na zona segura (80%)
        if (this.lumePosition >= 80) {
            console.log('üéâ LUME CHEGOU NA ZONA SEGURA!');
            setTimeout(() => {
                this.onReachSafety();
            }, 1000);
        }
    },

    // Perigo avan√ßa (quando erra)
    dangerAdvances: function() {
        console.log('‚ùå dangerAdvances() chamado');

        // Perigo avan√ßa 10% por erro
        this.dangerPosition += 10;

        console.log('üêâ Perigo avan√ßou para:', this.dangerPosition + '%');

        // Adicionar classe de anima√ß√£o
        const danger = document.getElementById('danger-chaser');
        danger.classList.add('advancing');

        // Atualizar posi√ß√£o
        this.updatePositions();

        // Remover classe ap√≥s anima√ß√£o
        setTimeout(() => {
            danger.classList.remove('advancing');
        }, 1000);
    },

    // Criar part√≠culas de corrida
    createRunParticles: function() {
        const lume = document.getElementById('lume-runner');
        const rect = lume.getBoundingClientRect();

        for (let i = 0; i < 6; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.className = 'run-particle';
                particle.style.left = rect.left + 'px';
                particle.style.top = (rect.top + rect.height / 2) + 'px';
                particle.style.position = 'fixed';

                document.body.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 800);
            }, i * 50);
        }
    },

    // Quando perigo fica muito pr√≥ximo
    onDangerClose: function() {
        console.warn('‚ö†Ô∏è PERIGO MUITO PR√ìXIMO DE LUME!');

        const lume = document.getElementById('lume-runner');
        lume.style.animation = 'tremble 0.3s';

        setTimeout(() => {
            lume.style.animation = '';
        }, 300);
    },

    // Quando chega na zona segura
    onReachSafety: function() {
        console.log('üéâ Lume chegou na zona segura!');

        const lume = document.getElementById('lume-runner');
        lume.style.transform = 'scale(1.5)';

        // Efeito de vit√≥ria
        this.createVictoryEffect();
    },

    // Efeito de vit√≥ria
    createVictoryEffect: function() {
        const emojis = ['‚≠ê', 'üåü', '‚ú®', 'üí´', 'üéâ', 'üéä'];

        for (let i = 0; i < 20; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                particle.className = 'victory-burst';

                // Posi√ß√£o inicial (perto da zona segura)
                const startX = window.innerWidth - 100;
                const startY = window.innerHeight - 100;

                particle.style.left = startX + 'px';
                particle.style.top = startY + 'px';

                // Dire√ß√£o aleat√≥ria
                const tx = (Math.random() - 0.5) * 300;
                const ty = (Math.random() - 0.5) * 300;
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');

                document.body.appendChild(particle);

                setTimeout(() => particle.remove(), 1500);
            }, i * 80);
        }
    },

    // Feedback de acerto
    onCorrect: function() {
        console.log('‚úÖ Resposta correta! Lume avan√ßa...');
        this.runForward();
    },

    // Feedback de erro
    onWrong: function() {
        console.log('‚ùå Resposta errada! Perigo avan√ßa...');
        this.dangerAdvances();

        // Shake effect em Lume
        const lume = document.getElementById('lume-runner');
        lume.style.animation = 'tremble 0.5s';
        setTimeout(() => {
            lume.style.animation = '';
        }, 500);
    },

    // Resetar mec√¢nica
    reset: function() {
        this.currentStep = 0;
        this.lumePosition = 20;
        this.dangerPosition = 0;
        this.updatePositions();

        const lume = document.getElementById('lume-runner');
        if (lume) {
            lume.style.transform = 'scale(1)';
        }
    },

    // Destruir mec√¢nica
    destroy: function() {
        const container = document.getElementById('perseguicao-container');
        if (container) {
            container.remove();
        }

        const styles = document.getElementById('perseguicao-styles');
        if (styles) {
            styles.remove();
        }
    }
};

// Expor globalmente
window.PERSEGUICAO = PERSEGUICAO;

console.log('üèÉ‚Äç‚ôÇÔ∏è perseguicao.js carregado!');

            
            // ========== MODALITIES ==========
            
// ===== quiz.js =====
// ===== MODALIDADE: QUIZ =====
// M√∫ltipla escolha com 4 alternativas

const QUIZ = {
    name: 'quiz',
    currentQuestion: null,
    
    // Criar UI do quiz
    createUI: function(data) {
        const container = document.createElement('div');
        container.className = 'quiz-container';
        
        // Pergunta
        const questionBox = document.createElement('div');
        questionBox.className = 'quiz-question';
        questionBox.innerHTML = `
            <div class="question-icon">‚ùì</div>
            <div class="question-text">${data.pergunta}</div>
        `;
        container.appendChild(questionBox);
        
        // Alternativas
        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'quiz-options';
        
        data.alternativas.forEach((alternativa, index) => {
            const button = document.createElement('button');
            button.className = 'quiz-option';
            
            // Letras A, B, C, D
            const letter = String.fromCharCode(65 + index);
            button.innerHTML = `
                <span class="option-letter">${letter}</span>
                <span class="option-text">${alternativa}</span>
            `;
            
            button.setAttribute('data-index', index);
            
            // ‚úÖ Usar bind(this) para manter contexto correto
            button.onclick = this.selectOption.bind(this, index, data.correta, data);
            
            optionsContainer.appendChild(button);
        });
        
        container.appendChild(optionsContainer);
        
        // Injetar CSS se ainda n√£o foi
        this.injectCSS();
        
        this.currentQuestion = data;
        
        return container;
    },
    
    // Selecionar op√ß√£o
    selectOption: function(selectedIndex, correctIndex, data) {
        const isCorrect = selectedIndex === correctIndex;
        
        // ‚úÖ PEGAR SOMENTE bot√µes da fase ATIVA (n√£o de todas as fases!)
        const currentPhase = document.querySelector('.phase.active');
        if (!currentPhase) {
            console.error('‚ùå Fase ativa n√£o encontrada!');
            return;
        }
        
        const buttons = currentPhase.querySelectorAll('.quiz-option');
        
        console.log('üéØ Resposta selecionada:', selectedIndex, '| Correta:', correctIndex, '| Acertou:', isCorrect);
        console.log('üîò Desabilitando', buttons.length, 'bot√µes da fase atual');
        
        // Desabilitar todos os bot√µes DA FASE ATUAL
        buttons.forEach(btn => {
            btn.disabled = true;
            btn.style.cursor = 'not-allowed';
            btn.style.opacity = '0.6';
        });
        
        // Marcar resposta selecionada
        const selectedButton = buttons[selectedIndex];
        const correctButton = buttons[correctIndex];
        
        if (isCorrect) {
            // ACERTOU
            selectedButton.classList.add('correct');
            selectedButton.style.opacity = '1';

            // Feedback
            const feedbackMsg = data.feedback_correto || '‚úÖ Correto! Muito bem!';
            showFeedback(feedbackMsg, 'correct');
            playSound('success');

        } else {
            // ERROU
            selectedButton.classList.add('wrong');
            selectedButton.style.opacity = '1';

            // Mostrar resposta correta ap√≥s 500ms
            setTimeout(() => {
                correctButton.classList.add('correct');
                correctButton.style.opacity = '1';
            }, 500);

            // Feedback
            const feedbackMsg = data.feedback_errado || '‚ùå Ops! A resposta correta era a alternativa ' + String.fromCharCode(65 + correctIndex);
            showFeedback(feedbackMsg, 'wrong');
            playSound('error');
        }

        // ‚úÖ CHAMAR CALLBACK CENTRAL (registra no Game Engine, anima mec√¢nica, avan√ßa fase)
        const phaseNumber = window.gameState ? window.gameState.currentPhase : 1;

        if (window.onAnswerChecked) {
            onAnswerChecked(isCorrect, phaseNumber);
        } else {
            console.error('‚ùå onAnswerChecked n√£o encontrado! Verifique se base.js foi carregado.');
        }
    },
    
    // Injetar CSS
    injectCSS: function() {
        if (document.getElementById('quiz-styles')) return;
        
        const style = document.createElement('style');
        style.id = 'quiz-styles';
        style.textContent = `
            /* Container do Quiz */
            .quiz-container {
                max-width: 700px;
                margin: 0 auto;
                padding: 20px;
            }
            
            /* Pergunta */
            .quiz-question {
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
                border: 3px solid #667eea;
                border-radius: 20px;
                padding: 30px;
                margin-bottom: 30px;
                text-align: center;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }
            
            .question-icon {
                font-size: 3rem;
                margin-bottom: 15px;
                animation: bounce 2s ease-in-out infinite;
            }
            
            @keyframes bounce {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
            }
            
            .question-text {
                font-size: 1.4rem;
                font-weight: 600;
                color: #212529;
                line-height: 1.6;
            }
            
            /* Alternativas */
            .quiz-options {
                display: grid;
                gap: 15px;
            }
            
            .quiz-option {
                display: flex;
                align-items: center;
                padding: 20px 25px;
                background: white;
                border: 3px solid #dee2e6;
                border-radius: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: left;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            .quiz-option:hover:not(:disabled) {
                transform: translateX(10px);
                border-color: #667eea;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                background: linear-gradient(to right, #ffffff, #f8f9ff);
            }
            
            .quiz-option:active:not(:disabled) {
                transform: translateX(5px);
            }
            
            /* Letra da alternativa */
            .option-letter {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                font-weight: bold;
                font-size: 1.2rem;
                border-radius: 50%;
                margin-right: 20px;
                flex-shrink: 0;
                transition: transform 0.3s ease;
            }
            
            .quiz-option:hover:not(:disabled) .option-letter {
                transform: scale(1.2) rotate(10deg);
            }
            
            /* Texto da alternativa */
            .option-text {
                font-size: 1.1rem;
                font-weight: 500;
                color: #212529;
                line-height: 1.5;
            }
            
            /* Estado: Correta */
            .quiz-option.correct {
                background: linear-gradient(135deg, #51cf66, #38d9a9);
                border-color: #37b24d;
                animation: correctPulse 0.6s ease;
            }
            
            .quiz-option.correct .option-letter {
                background: #2f9e44;
            }
            
            .quiz-option.correct .option-text {
                color: white;
                font-weight: 700;
            }
            
            @keyframes correctPulse {
                0%, 100% { transform: scale(1) translateX(0); }
                50% { transform: scale(1.03) translateX(10px); }
            }
            
            /* Estado: Errada */
            .quiz-option.wrong {
                background: linear-gradient(135deg, #ff6b6b, #ff8787);
                border-color: #f03e3e;
                animation: wrongShake 0.5s ease;
            }
            
            .quiz-option.wrong .option-letter {
                background: #c92a2a;
            }
            
            .quiz-option.wrong .option-text {
                color: white;
                font-weight: 700;
            }
            
            @keyframes wrongShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                50% { transform: translateX(10px); }
                75% { transform: translateX(-5px); }
            }
            
            /* Responsivo */
            @media (max-width: 768px) {
                .quiz-container {
                    padding: 15px;
                }
                
                .quiz-question {
                    padding: 20px;
                }
                
                .question-icon {
                    font-size: 2.5rem;
                }
                
                .question-text {
                    font-size: 1.1rem;
                }
                
                .quiz-option {
                    padding: 15px 20px;
                }
                
                .option-letter {
                    width: 35px;
                    height: 35px;
                    font-size: 1rem;
                    margin-right: 15px;
                }
                
                .option-text {
                    font-size: 1rem;
                }
            }
        `;
        
        document.head.appendChild(style);
    }
};

// Expor globalmente
window.QUIZ = QUIZ;

console.log('üìù quiz.js carregado!');


// ===== true-false.js =====
// ===== MODALIDADE: VERDADEIRO OU FALSO =====
// Afirma√ß√µes para julgar como verdadeiras ou falsas

const TRUE_FALSE = {
    name: 'true-false',
    currentQuestion: null,
    
    // Criar UI
    createUI: function(data) {
        const container = document.createElement('div');
        container.className = 'true-false-container';
        
        // Afirma√ß√£o
        const statementBox = document.createElement('div');
        statementBox.className = 'tf-statement';
        statementBox.innerHTML = `
            <div class="statement-icon">ü§î</div>
            <div class="statement-text">${data.afirmacao}</div>
        `;
        container.appendChild(statementBox);
        
        // Bot√µes V ou F
        const buttonsContainer = document.createElement('div');
        buttonsContainer.className = 'tf-buttons';
        
        // Bot√£o VERDADEIRO
        const trueButton = document.createElement('button');
        trueButton.className = 'tf-button tf-true';
        trueButton.innerHTML = `
            <div class="tf-icon">‚úì</div>
            <div class="tf-label">VERDADEIRO</div>
        `;
        trueButton.onclick = () => this.selectOption(true, data.correta, data);
        
        // Bot√£o FALSO
        const falseButton = document.createElement('button');
        falseButton.className = 'tf-button tf-false';
        falseButton.innerHTML = `
            <div class="tf-icon">‚úó</div>
            <div class="tf-label">FALSO</div>
        `;
        falseButton.onclick = () => this.selectOption(false, data.correta, data);
        
        buttonsContainer.appendChild(trueButton);
        buttonsContainer.appendChild(falseButton);
        container.appendChild(buttonsContainer);
        
        // Injetar CSS
        this.injectCSS();
        
        this.currentQuestion = data;
        
        return container;
    },
    
    // Selecionar op√ß√£o
    selectOption: function(selectedValue, correctValue, data) {
        const isCorrect = selectedValue === correctValue;
        const buttons = document.querySelectorAll('.tf-button');
        
        console.log('üéØ Resposta:', selectedValue, '| Correta:', correctValue, '| Acertou:', isCorrect);
        
        // Desabilitar bot√µes
        buttons.forEach(btn => {
            btn.disabled = true;
            btn.style.cursor = 'not-allowed';
            btn.style.opacity = '0.6';
        });
        
        // Marcar bot√£o selecionado
        const selectedButton = selectedValue ? buttons[0] : buttons[1];
        const correctButton = correctValue ? buttons[0] : buttons[1];
        
        if (isCorrect) {
            // ACERTOU
            selectedButton.classList.add('correct');
            selectedButton.style.opacity = '1';

            const feedbackMsg = data.feedback_correto || '‚úÖ Correto!';
            showFeedback(feedbackMsg, 'correct');
            playSound('success');

        } else {
            // ERROU
            selectedButton.classList.add('wrong');
            selectedButton.style.opacity = '1';

            // Mostrar resposta correta
            setTimeout(() => {
                correctButton.classList.add('correct');
                correctButton.style.opacity = '1';
            }, 500);

            const feedbackMsg = data.feedback_errado || '‚ùå Incorreto! A resposta √© ' + (correctValue ? 'VERDADEIRO' : 'FALSO');
            showFeedback(feedbackMsg, 'wrong');
            playSound('error');
        }

        // ‚úÖ CHAMAR CALLBACK CENTRAL (registra no Game Engine, anima mec√¢nica, avan√ßa fase)
        const phaseNumber = window.gameState ? window.gameState.currentPhase : 1;

        if (window.onAnswerChecked) {
            onAnswerChecked(isCorrect, phaseNumber);
        } else {
            console.error('‚ùå onAnswerChecked n√£o encontrado! Verifique se base.js foi carregado.');
        }
    },
    
    // Injetar CSS
    injectCSS: function() {
        if (document.getElementById('true-false-styles')) return;
        
        const style = document.createElement('style');
        style.id = 'true-false-styles';
        style.textContent = `
            /* Container */
            .true-false-container {
                max-width: 700px;
                margin: 0 auto;
                padding: 20px;
            }
            
            /* Afirma√ß√£o */
            .tf-statement {
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
                border: 3px solid #667eea;
                border-radius: 20px;
                padding: 40px;
                margin-bottom: 40px;
                text-align: center;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }
            
            .statement-icon {
                font-size: 4rem;
                margin-bottom: 20px;
                animation: thinking 2s ease-in-out infinite;
            }
            
            @keyframes thinking {
                0%, 100% { transform: rotate(-5deg); }
                50% { transform: rotate(5deg); }
            }
            
            .statement-text {
                font-size: 1.6rem;
                font-weight: 600;
                color: #212529;
                line-height: 1.8;
            }
            
            /* Bot√µes */
            .tf-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
            }
            
            .tf-button {
                padding: 40px 30px;
                background: white;
                border: 4px solid #dee2e6;
                border-radius: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .tf-button:hover:not(:disabled) {
                transform: translateY(-10px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            }
            
            .tf-button:active:not(:disabled) {
                transform: translateY(-5px);
            }
            
            /* Bot√£o Verdadeiro */
            .tf-true {
                border-color: #51cf66;
            }
            
            .tf-true:hover:not(:disabled) {
                background: linear-gradient(to bottom, #ffffff, #d3f9d8);
                border-color: #37b24d;
            }
            
            .tf-true .tf-icon {
                font-size: 4rem;
                font-weight: bold;
                color: #37b24d;
            }
            
            .tf-true .tf-label {
                font-size: 1.4rem;
                font-weight: 700;
                color: #2f9e44;
            }
            
            /* Bot√£o Falso */
            .tf-false {
                border-color: #ff6b6b;
            }
            
            .tf-false:hover:not(:disabled) {
                background: linear-gradient(to bottom, #ffffff, #ffe0e0);
                border-color: #f03e3e;
            }
            
            .tf-false .tf-icon {
                font-size: 4rem;
                font-weight: bold;
                color: #f03e3e;
            }
            
            .tf-false .tf-label {
                font-size: 1.4rem;
                font-weight: 700;
                color: #c92a2a;
            }
            
            /* Estado: Correto */
            .tf-button.correct {
                background: linear-gradient(135deg, #51cf66, #38d9a9);
                border-color: #2f9e44;
                animation: correctPulse 0.6s ease;
            }
            
            .tf-button.correct .tf-icon,
            .tf-button.correct .tf-label {
                color: white;
            }
            
            @keyframes correctPulse {
                0%, 100% { transform: scale(1) translateY(0); }
                50% { transform: scale(1.05) translateY(-10px); }
            }
            
            /* Estado: Errado */
            .tf-button.wrong {
                background: linear-gradient(135deg, #ff6b6b, #ff8787);
                border-color: #c92a2a;
                animation: wrongShake 0.5s ease;
            }
            
            .tf-button.wrong .tf-icon,
            .tf-button.wrong .tf-label {
                color: white;
            }
            
            @keyframes wrongShake {
                0%, 100% { transform: translateX(0) translateY(0); }
                25% { transform: translateX(-15px) translateY(-5px); }
                50% { transform: translateX(15px) translateY(-5px); }
                75% { transform: translateX(-10px) translateY(-5px); }
            }
            
            /* Responsivo */
            @media (max-width: 768px) {
                .true-false-container {
                    padding: 15px;
                }
                
                .tf-statement {
                    padding: 25px;
                }
                
                .statement-icon {
                    font-size: 3rem;
                }
                
                .statement-text {
                    font-size: 1.2rem;
                }
                
                .tf-buttons {
                    gap: 20px;
                }
                
                .tf-button {
                    padding: 30px 20px;
                }
                
                .tf-icon {
                    font-size: 3rem !important;
                }
                
                .tf-label {
                    font-size: 1.1rem !important;
                }
            }
        `;
        
        document.head.appendChild(style);
    }
};

// Expor globalmente
window.TRUE_FALSE = TRUE_FALSE;

console.log('‚úì‚úó true-false.js carregado!');

// ===== fill-blanks.js =====
const FILL_BLANKS = {
    name: 'fill-blanks',
    
    createUI: function(data) {
        const container = document.createElement('div');
        container.className = 'fill-blanks-container';
        container.innerHTML = `
            <div class="fb-header">
                <div class="fb-icon">‚úèÔ∏è</div>
                <div class="fb-title">Complete a frase:</div>
            </div>
            <div class="fb-sentence">
                ${data.frase.replace('____', '<input type="text" class="fb-input" id="fb-answer" placeholder="?" autocomplete="off">')}
            </div>
            ${data.dica ? `<div class="fb-hint">üí° Dica: ${data.dica}</div>` : ''}
            <button class="fb-button">‚úì CONFIRMAR</button>
        `;
        
        this.injectCSS();
        
        setTimeout(() => {
            const input = document.getElementById('fb-answer');
            const button = container.querySelector('.fb-button');
            if (input) input.focus();
            if (button) button.onclick = () => this.checkAnswer(data);
            if (input) input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') this.checkAnswer(data);
            });
        }, 100);
        
        return container;
    },
    
    checkAnswer: function(data) {
        const input = document.getElementById('fb-answer');
        const button = document.querySelector('.fb-button');
        if (!input || !button) return;
        
        const userAnswer = input.value.trim().toLowerCase();
        const correctAnswer = data.resposta.toLowerCase();
        const aceitas = data.variacoes_aceitas || [correctAnswer];
        const isCorrect = aceitas.some(v => userAnswer === v.toLowerCase());
        
        input.disabled = true;
        button.disabled = true;
        
        if (isCorrect) {
            input.classList.add('correct');
            button.classList.add('correct');
            showFeedback(data.feedback_correto || '‚úÖ Correto!', 'correct');
            playSound('success');

        } else {
            input.classList.add('wrong');
            button.classList.add('wrong');
            setTimeout(() => {
                input.value = data.resposta;
                input.classList.remove('wrong');
                input.classList.add('show-correct');
            }, 800);
            showFeedback(data.feedback_errado || `‚ùå Resposta: ${data.resposta}`, 'wrong');
            playSound('error');
        }

        // ‚úÖ CHAMAR CALLBACK CENTRAL (registra no Game Engine, anima mec√¢nica, avan√ßa fase)
        const phaseNumber = window.gameState ? window.gameState.currentPhase : 1;

        if (window.onAnswerChecked) {
            onAnswerChecked(isCorrect, phaseNumber);
        } else {
            console.error('‚ùå onAnswerChecked n√£o encontrado! Verifique se base.js foi carregado.');
        }
    },
    
    injectCSS: function() {
        if (document.getElementById('fill-blanks-styles')) return;
        const style = document.createElement('style');
        style.id = 'fill-blanks-styles';
        style.textContent = `
            .fill-blanks-container { max-width: 700px; margin: 0 auto; padding: 20px; }
            .fb-header { text-align: center; margin-bottom: 30px; }
            .fb-icon { font-size: 3.5rem; margin-bottom: 10px; }
            .fb-title { font-size: 1.3rem; font-weight: 600; color: #495057; }
            .fb-sentence { background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border: 3px solid #667eea; border-radius: 20px; padding: 40px; margin-bottom: 30px; font-size: 1.8rem; font-weight: 600; color: #212529; line-height: 2.5; text-align: center; }
            .fb-input { display: inline-block; min-width: 150px; padding: 10px 20px; font-size: 1.8rem; font-weight: 700; text-align: center; border: 3px solid #667eea; border-radius: 10px; background: white; color: #212529; outline: none; }
            .fb-input:focus { border-color: #5a67d8; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2); transform: scale(1.05); }
            .fb-input.correct { background: linear-gradient(135deg, #51cf66, #38d9a9); border-color: #37b24d; color: white; }
            .fb-input.wrong { background: linear-gradient(135deg, #ff6b6b, #ff8787); border-color: #f03e3e; color: white; animation: shake 0.5s; }
            .fb-input.show-correct { background: linear-gradient(135deg, #51cf66, #38d9a9); border-color: #37b24d; color: white; }
            @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 50% { transform: translateX(10px); } 75% { transform: translateX(-5px); } }
            .fb-hint { background: rgba(255, 193, 7, 0.15); border-left: 4px solid #ffc107; border-radius: 8px; padding: 15px 20px; margin-bottom: 30px; font-size: 1rem; color: #856404; }
            .fb-button { width: 100%; padding: 20px; font-size: 1.3rem; font-weight: 700; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
            .fb-button:hover:not(:disabled) { transform: translateY(-3px); }
            .fb-button:disabled { opacity: 0.6; cursor: not-allowed; }
            .fb-button.correct { background: linear-gradient(135deg, #51cf66, #38d9a9); }
            .fb-button.wrong { background: linear-gradient(135deg, #ff6b6b, #ff8787); }
        `;
        document.head.appendChild(style);
    }
};

window.FILL_BLANKS = FILL_BLANKS;
console.log('‚úèÔ∏è fill-blanks.js carregado!');

// ===== sequence.js =====
// ===== MODALIDADE: ORDENAR SEQUENCIA (DRAG AND DROP) =====

const SEQUENCE = {
    name: 'sequence',
    currentQuestion: null,
    currentOrder: [],
    draggedIndex: null,
    
    createUI: function(data) {
        const container = document.createElement('div');
        container.className = 'sequence-container';
        
        const headerBox = document.createElement('div');
        headerBox.className = 'seq-header';
        headerBox.innerHTML = '<div class="seq-icon">123</div><div class="seq-title">Arraste para ordenar:</div>';
        container.appendChild(headerBox);
        
        if (data.instrucao) {
            const instrBox = document.createElement('div');
            instrBox.className = 'seq-instruction';
            instrBox.textContent = data.instrucao;
            container.appendChild(instrBox);
        }
        
        this.currentOrder = this.shuffle([...data.itens]);
        
        const listBox = document.createElement('div');
        listBox.className = 'seq-list';
        listBox.id = 'seq-list';
        
        this.renderList(listBox, this.currentOrder);
        container.appendChild(listBox);
        
        const button = document.createElement('button');
        button.className = 'seq-button';
        button.textContent = 'CONFIRMAR ORDEM';
        button.onclick = () => this.checkAnswer(data);
        container.appendChild(button);
        
        this.injectCSS();
        this.currentQuestion = data;
        
        return container;
    },
    
    renderList: function(listBox, items) {
        listBox.innerHTML = '';
        
        items.forEach((item, index) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'seq-item';
            itemDiv.draggable = true;
            itemDiv.dataset.index = index;
            
            // Eventos de drag
            itemDiv.addEventListener('dragstart', (e) => this.handleDragStart(e, index));
            itemDiv.addEventListener('dragover', (e) => this.handleDragOver(e));
            itemDiv.addEventListener('drop', (e) => this.handleDrop(e, index));
            itemDiv.addEventListener('dragend', (e) => this.handleDragEnd(e));
            
            const number = document.createElement('div');
            number.className = 'seq-number';
            number.textContent = index + 1;
            
            const text = document.createElement('div');
            text.className = 'seq-text';
            text.textContent = item;
            
            const dragIcon = document.createElement('div');
            dragIcon.className = 'seq-drag-icon';
            dragIcon.innerHTML = '&#8801;';
            
            itemDiv.appendChild(number);
            itemDiv.appendChild(text);
            itemDiv.appendChild(dragIcon);
            
            listBox.appendChild(itemDiv);
        });
    },
    
    handleDragStart: function(e, index) {
        this.draggedIndex = index;
        e.currentTarget.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        playSound('click');
    },
    
    handleDragOver: function(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        return false;
    },
    
    handleDrop: function(e, dropIndex) {
        e.preventDefault();
        e.stopPropagation();
        
        if (this.draggedIndex === null || this.draggedIndex === dropIndex) {
            return;
        }
        
        // Reordenar array
        const draggedItem = this.currentOrder[this.draggedIndex];
        this.currentOrder.splice(this.draggedIndex, 1);
        this.currentOrder.splice(dropIndex, 0, draggedItem);
        
        // Re-renderizar
        const listBox = document.getElementById('seq-list');
        this.renderList(listBox, this.currentOrder);
        
        playSound('click');
    },
    
    handleDragEnd: function(e) {
        e.currentTarget.classList.remove('dragging');
        this.draggedIndex = null;
    },
    
    shuffle: function(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            const temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
        }
        return arr;
    },
    
    checkAnswer: function(data) {
        const button = document.querySelector('.seq-button');
        const items = document.querySelectorAll('.seq-item');
        
        button.disabled = true;
        
        // Desabilitar drag
        items.forEach(item => {
            item.draggable = false;
            item.style.cursor = 'default';
        });
        
        const isCorrect = JSON.stringify(this.currentOrder) === JSON.stringify(data.ordem_correta);
        
        if (isCorrect) {
            items.forEach(item => item.classList.add('correct'));
            button.classList.add('correct');

            showFeedback(data.feedback_correto || 'Perfeito!', 'correct');
            playSound('success');

        } else {
            items.forEach(item => item.classList.add('wrong'));
            button.classList.add('wrong');

            setTimeout(() => {
                items.forEach(item => item.classList.remove('wrong'));
                this.currentOrder = [...data.ordem_correta];
                const listBox = document.getElementById('seq-list');
                this.renderList(listBox, this.currentOrder);

                const newItems = document.querySelectorAll('.seq-item');
                newItems.forEach(item => {
                    item.classList.add('show-correct');
                    item.draggable = false;
                    item.style.cursor = 'default';
                });
            }, 1000);

            showFeedback(data.feedback_errado || 'Ops! Veja a ordem correta.', 'wrong');
            playSound('error');
        }

        // ‚úÖ CHAMAR CALLBACK CENTRAL (registra no Game Engine, anima mec√¢nica, avan√ßa fase)
        const phaseNumber = window.gameState ? window.gameState.currentPhase : 1;

        if (window.onAnswerChecked) {
            onAnswerChecked(isCorrect, phaseNumber);
        } else {
            console.error('‚ùå onAnswerChecked n√£o encontrado! Verifique se base.js foi carregado.');
        }
    },
    
    injectCSS: function() {
        if (document.getElementById('sequence-styles')) return;
        
        const style = document.createElement('style');
        style.id = 'sequence-styles';
        style.textContent = `
            .sequence-container { max-width: 700px; margin: 0 auto; padding: 20px; }
            .seq-header { text-align: center; margin-bottom: 30px; }
            .seq-icon { font-size: 3.5rem; margin-bottom: 10px; }
            .seq-title { font-size: 1.3rem; font-weight: 600; color: #495057; }
            .seq-instruction { background: rgba(102, 126, 234, 0.1); border-left: 4px solid #667eea; border-radius: 8px; padding: 15px 20px; margin-bottom: 30px; font-size: 1rem; color: #495057; font-weight: 500; }
            .seq-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
            
            .seq-item { 
                background: white; 
                border: 3px solid #dee2e6; 
                border-radius: 15px; 
                padding: 15px 20px; 
                display: flex; 
                align-items: center; 
                gap: 15px; 
                box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
                cursor: grab;
                transition: all 0.2s ease;
                user-select: none;
            }
            
            .seq-item:hover {
                border-color: #667eea;
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
                transform: translateY(-2px);
            }
            
            .seq-item:active {
                cursor: grabbing;
            }
            
            .seq-item.dragging {
                opacity: 0.5;
                cursor: grabbing;
                transform: rotate(3deg);
            }
            
            .seq-number { 
                background: linear-gradient(135deg, #667eea, #764ba2); 
                color: white; 
                width: 40px; 
                height: 40px; 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                font-weight: 700; 
                font-size: 1.2rem;
                flex-shrink: 0;
            }
            
            .seq-text { 
                flex: 1; 
                font-size: 1.1rem; 
                font-weight: 600; 
                color: #212529; 
            }
            
            .seq-drag-icon {
                font-size: 1.5rem;
                color: #adb5bd;
                cursor: grab;
                flex-shrink: 0;
            }
            
            .seq-item:active .seq-drag-icon {
                cursor: grabbing;
            }
            
            .seq-item.correct { 
                background: linear-gradient(135deg, #d3f9d8, #b2f2bb); 
                border-color: #51cf66;
                animation: correctPulse 0.6s ease;
            }
            
            .seq-item.correct .seq-number { 
                background: linear-gradient(135deg, #51cf66, #38d9a9); 
            }
            
            .seq-item.wrong { 
                background: linear-gradient(135deg, #ffe0e0, #ffc9c9); 
                border-color: #ff6b6b; 
                animation: shake 0.5s; 
            }
            
            .seq-item.show-correct { 
                background: linear-gradient(135deg, #d3f9d8, #b2f2bb); 
                border-color: #51cf66; 
            }
            
            .seq-item.show-correct .seq-number { 
                background: linear-gradient(135deg, #51cf66, #38d9a9); 
            }
            
            @keyframes correctPulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.02); }
            }
            
            @keyframes shake { 
                0%, 100% { transform: translateX(0); } 
                25% { transform: translateX(-10px); } 
                50% { transform: translateX(10px); } 
                75% { transform: translateX(-5px); } 
            }
            
            .seq-button { 
                width: 100%; 
                padding: 20px; 
                font-size: 1.3rem; 
                font-weight: 700; 
                background: linear-gradient(135deg, #667eea, #764ba2); 
                color: white; 
                border: none; 
                border-radius: 15px; 
                cursor: pointer; 
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); 
                transition: all 0.3s ease;
            }
            
            .seq-button:hover:not(:disabled) { 
                transform: translateY(-3px); 
                box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            }
            
            .seq-button:disabled { 
                opacity: 0.6; 
                cursor: not-allowed; 
            }
            
            .seq-button.correct { 
                background: linear-gradient(135deg, #51cf66, #38d9a9); 
            }
            
            .seq-button.wrong { 
                background: linear-gradient(135deg, #ff6b6b, #ff8787); 
            }
        `;
        
        document.head.appendChild(style);
    }
};

window.SEQUENCE = SEQUENCE;
console.log('sequence.js carregado com drag and drop!');

            
            // ========== GAME DATA ==========
            const GAME_CONFIG = {
  "tema": "üèÉ‚Äç‚ôÇÔ∏è Teste Persegui√ß√£o - IAlume Factory",
  "descricao": "Teste da mec√¢nica de persegui√ß√£o: Lume foge do drag√£o da ignor√¢ncia!",
  "mecanica": "perseguicao",
  "fases": [
    {
      "type": "welcome"
    },
    {
      "modalidade": "quiz",
      "dados": {
        "pergunta": "üèÉ‚Äç‚ôÇÔ∏è Qual animal √© mais r√°pido em terra?",
        "alternativas": [
          "Le√£o",
          "Guepardo",
          "Cavalo",
          "Lobo"
        ],
        "correta": 1,
        "feedback_correto": "‚úÖ Isso! O guepardo √© o mais r√°pido! üêÜ",
        "feedback_errado": "‚ùå O guepardo √© o mais r√°pido em terra!"
      }
    },
    {
      "modalidade": "true-false",
      "dados": {
        "afirmacao": "üêâ Drag√µes existiram de verdade na pr√©-hist√≥ria.",
        "correta": false,
        "feedback_correto": "‚úÖ Correto! Drag√µes s√£o apenas lendas!",
        "feedback_errado": "‚ùå Drag√µes s√£o criaturas mitol√≥gicas, n√£o reais!"
      }
    },
    {
      "modalidade": "fill-blanks",
      "dados": {
        "frase": "‚ö° A velocidade da luz √© aproximadamente ____ km/s.",
        "resposta": "300000",
        "variacoes_aceitas": [
          "300000",
          "300.000",
          "300 mil"
        ],
        "dica": "Um n√∫mero bem grande!",
        "feedback_correto": "‚úÖ Perfeito! A luz viaja a 300.000 km/s!",
        "feedback_errado": "‚ùå A velocidade da luz √© 300.000 km/s."
      }
    },
    {
      "modalidade": "sequence",
      "dados": {
        "instrucao": "üèÉ‚Äç‚ôÇÔ∏è Ordene estas a√ß√µes de uma corrida:",
        "itens": [
          "Chegada",
          "Partida",
          "Acelera√ß√£o",
          "Respira√ß√£o final"
        ],
        "ordem_correta": [
          "Partida",
          "Acelera√ß√£o",
          "Respira√ß√£o final",
          "Chegada"
        ],
        "feedback_correto": "‚úÖ Excelente! Voc√™ escapou do drag√£o! üéâ",
        "feedback_errado": "‚ùå A ordem correta √© diferente!"
      }
    }
  ]
};
            
            // ========== INITIALIZATION ==========
            window.totalPhases = 5;
            
            console.log('üéÆ Inicializando jogo...');
            console.log('üìä Total de fases:', window.totalPhases);
            console.log('üìã Config:', GAME_CONFIG);
            
            // Aguardar DOM carregar
            window.addEventListener('DOMContentLoaded', function() {
                console.log('‚úÖ DOM carregado!');
                
                // Verificar se Game Engine existe
                if (!window.GAME_ENGINE) {
                    console.error('‚ùå GAME_ENGINE n√£o encontrado!');
                    alert('Erro: Game Engine n√£o carregado!');
                    return;
                }
                
                // Verificar se modalidades existem
                console.log('Modalidades dispon√≠veis:', {
                    QUIZ: typeof window.QUIZ,
                    TRUE_FALSE: typeof window.TRUE_FALSE,
                    FILL_BLANKS: typeof window.FILL_BLANKS,
                    SEQUENCE: typeof window.SEQUENCE
                });
                
                // Inicializar jogo
                console.log('üöÄ Iniciando Game Engine...');
                GAME_ENGINE.init(GAME_CONFIG);
            });
        
    </script>
</body>
</html>